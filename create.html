<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Your Plan - My Last Key</title>
    <link rel="stylesheet" href="assets/css/style.css">
    <!-- CDN Dependencies with SRI -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.2.0/crypto-js.min.js" 
            integrity="sha512-a+SUDuwNzXDvz4XrIcXHuCf089/iJAoN4lmrXJg18XnduKK6YlDHNRalv4yd1N40OKI80tFidF+rqTFKGPoWFQ==" 
            crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js" 
            integrity="sha512-CNgIRecGo7nphbeZ04Sc13ka07paqdeTu0WR1IM4kNcpmBAUSHSQX0FslNhTDadL4O5SAGapGt4FodqL8My0mA==" 
            crossorigin="anonymous"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .header {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .header h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .header .subtitle {
            font-size: 1.2em;
            color: #666;
            margin-bottom: 25px;
        }

        .header-nav {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .nav-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: #3498db;
            color: white;
            padding: 12px 24px;
            text-decoration: none;
            border-radius: 25px;
            font-weight: 600;
            transition: all 0.3s;
            border: none;
            cursor: pointer;
            font-size: 1em;
        }

        .nav-btn:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }

        .nav-btn.secondary {
            background: #95a5a6;
        }

        .nav-btn.secondary:hover {
            background: #7f8c8d;
        }

        .nav-btn.active {
            background: #e74c3c;
        }

        .nav-btn.active:hover {
            background: #c0392b;
        }

        /* Top Controls */
        .top-controls {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .control-box {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            justify-content: center;
            min-height: 120px;
        }

        .master-key-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .qr-import-group {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .qr-buttons-row {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .view-print-group {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .view-print-row {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .import-btn-small {
            background: #f39c12;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 6px;
            white-space: nowrap;
        }

        .import-btn-small:hover {
            background: #e67e22;
            transform: translateY(-2px);
        }

        .export-btn-small {
            background: #27ae60;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 6px;
            white-space: nowrap;
        }

        .export-btn-small:hover {
            background: #229954;
            transform: translateY(-2px);
        }

        .export-toggle-inline {
            text-align: center;
        }

        .export-toggle-inline label {
            font-weight: 600;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            font-size: 0.9em;
        }

        .master-key-group label {
            font-weight: 600;
            color: #e74c3c;
            font-size: 1.1em;
        }

        .master-key-input {
            padding: 12px 16px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
            width: 100%;
        }

        .master-key-input:focus {
            outline: none;
            border-color: #3498db;
        }

        .toggle-group {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #3498db;
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        .toggle-label {
            font-weight: 600;
            color: #2c3e50;
        }

        .print-btn {
            background: #8e44ad;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
        }

        .print-btn:hover {
            background: #7d3c98;
            transform: translateY(-2px);
        }

        /* Import Button */
        .import-btn {
            background: #f39c12;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
        }

        .import-btn:hover {
            background: #e67e22;
            transform: translateY(-2px);
        }



        /* Export Toggle */
        .export-toggle-container {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 1px solid #e9ecef;
        }

        .export-toggle-container label {
            font-weight: 600;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }

        /* Export QR Code Container */
        #exportQrCodeContainer {
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 2px solid #3498db;
            text-align: center;
        }

        #exportQrCodeContainer h3 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        #exportQrCodeContainer p {
            color: #666;
            margin-bottom: 15px;
            font-style: italic;
        }

        #qrcode {
            display: flex;
            justify-content: center;
            margin-top: 15px;
        }

        /* Main Layout */
        .main-layout {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        /* Form Section */
        .form-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            height: fit-content;
        }

        .form-section h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        /* Input Row */
        .input-row {
            display: grid;
            grid-template-columns: 140px 1fr 1fr auto auto auto;
            gap: 12px;
            align-items: center;
            margin-bottom: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 1px solid #e9ecef;
        }

        .input-row select,
        .input-row input[type="text"] {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 0.9em;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.85em;
            font-weight: 500;
        }

        .checkbox-group input[type="checkbox"] {
            transform: scale(1.1);
        }

        .remove-btn {
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            cursor: pointer;
            font-size: 1.2em;
            transition: background 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .remove-btn:hover {
            background: #c0392b;
        }

        .add-row-btn {
            background: #27ae60;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            margin-top: 15px;
            transition: background 0.3s;
            font-weight: 600;
        }

        .add-row-btn:hover {
            background: #229954;
        }

        /* Preview Section */
        .preview-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            min-height: 700px;
        }

        .preview-section h2 {
            color: #2c3e50;
            margin-bottom: 25px;
            font-size: 1.8em;
            text-align: center;
        }

        /* Preview Content */
        .category-section {
            margin-bottom: 35px;
        }

        .category-section h3 {
            color: #34495e;
            border-bottom: 3px solid #3498db;
            padding-bottom: 8px;
            margin-bottom: 20px;
            font-size: 1.4em;
        }

        .entry {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 5px solid #3498db;
        }

        .entry-title {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 12px;
            font-size: 1.1em;
        }

        .entry-value {
            font-family: 'Courier New', monospace;
            font-size: 1.3em;
            margin-bottom: 15px;
            line-height: 1.5;
        }

        /* Password Table View */
        .password-table {
            display: table;
            width: 100%;
            border-collapse: separate;
            border-spacing: 2px;
            font-family: 'Courier New', monospace;
            font-size: 1.1em;
            margin: 10px 0;
        }

        .password-row {
            display: table-row;
        }

        .char-number {
            display: table-cell;
            width: 45px;
            text-align: center;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 10px 6px;
            font-size: 1.0em;
            color: #6c757d;
            font-weight: bold;
            vertical-align: middle;
        }

        .char-cell {
            display: table-cell;
            text-align: center;
            border: 2px solid #dee2e6;
            padding: 15px 10px;
            font-weight: bold;
            font-size: 1.4em;
            min-width: 45px;
            vertical-align: middle;
        }

        .char-cell.digit {
            background: #e3f2fd;
            border-color: #2196f3;
            color: #1976d2;
        }

        .char-cell.lower {
            background: #f3e5f5;
            border-color: #9c27b0;
            color: #7b1fa2;
        }

        .char-cell.upper {
            background: #e8f5e8;
            border-color: #4caf50;
            color: #388e3c;
        }

        .char-cell.special {
            background: #ffebee;
            border-color: #f44336;
            color: #d32f2f;
        }

        .row-spacer {
            height: 8px;
            border: none !important;
            background: transparent !important;
        }

        /* Simple text mode */
        .simple-text {
            font-family: 'Courier New', monospace;
            font-size: 1.3em;
            color: #2c3e50;
            letter-spacing: 2px;
            line-height: 1.8;
        }

        /* Sequence Boxes */
        .sequence-box {
            display: inline-block;
            border: 2px solid #34495e;
            padding: 12px 16px;
            margin: 4px;
            border-radius: 8px;
            background: white;
            font-weight: bold;
            font-size: 1.4em;
            min-width: 45px;
            text-align: center;
            box-shadow: 0 3px 6px rgba(0,0,0,0.1);
        }

        /* QR Code */
        .qr-code {
            margin-top: 15px;
            text-align: center;
            padding: 15px;
            background: white;
            border-radius: 8px;
            display: inline-block;
        }

        .qr-code canvas {
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        /* Encrypted indicator */
        .encrypted {
            color: #e74c3c;
            font-style: italic;
            background: rgba(231, 76, 60, 0.1);
            padding: 8px 12px;
            border-radius: 6px;
            border: 1px solid rgba(231, 76, 60, 0.2);
        }

        /* Print Customization Styles */
        .print-customization-fieldset {
            border: 2px solid #3498db;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            background: rgba(52, 152, 219, 0.05);
        }

        .print-customization-fieldset legend {
            color: #3498db;
            font-weight: 700;
            font-size: 1.1em;
            padding: 0 10px;
        }

        .print-settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            align-items: center;
        }

        .setting-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .setting-group label {
            font-weight: 600;
            color: #2c3e50;
            font-size: 0.9em;
        }

        .setting-group select {
            padding: 8px 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 0.9em;
            transition: border-color 0.3s;
            background: white;
        }

        .setting-group select:focus {
            outline: none;
            border-color: #3498db;
        }

        .lock-icon {
            margin-left: 8px;
            font-size: 1.1em;
        }

        /* Error Messages */
        .error-message {
            background: #fdf2f2;
            color: #e74c3c;
            padding: 12px 16px;
            border-radius: 8px;
            border-left: 4px solid #e74c3c;
            margin: 10px 0;
            font-weight: 500;
        }

        /* Import and Export Button Styles */
        .import-btn-small {
            background: #3498db;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.85em;
            font-weight: 600;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .import-btn-small:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }

        .export-btn-small {
            background: #f39c12;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.85em;
            font-weight: 600;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .export-btn-small:hover {
            background: #e67e22;
            transform: translateY(-2px);
        }

        .print-btn {
            background: #9b59b6;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.85em;
            font-weight: 600;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .print-btn:hover {
            background: #8e44ad;
            transform: translateY(-2px);
        }

        .add-row-btn {
            background: #27ae60;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s;
            margin-top: 15px;
        }

        .add-row-btn:hover {
            background: #229954;
            transform: translateY(-2px);
        }

        /* Toggle Switch Styles */
        .toggle-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .toggle-label {
            font-size: 0.9em;
            font-weight: 600;
            color: #2c3e50;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #3498db;
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        .view-print-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .view-print-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 15px;
        }

        /* Import Export Button Container */
        .import-export-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
            align-items: center;
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(3px);
        }

        .modal-overlay.visible {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow: hidden;
            animation: modalSlideIn 0.3s ease-out;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            margin: 0;
            font-size: 1.3em;
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.5em;
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.3s;
        }

        .modal-close:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .modal-body {
            padding: 25px;
        }

        .modal-description {
            color: #666;
            margin-bottom: 20px;
            line-height: 1.5;
            font-size: 0.95em;
        }

        .import-input-group {
            margin-bottom: 20px;
        }

        .import-input-group label {
            display: block;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
            font-size: 1em;
        }

        .import-input-group textarea {
            width: 100%;
            height: 120px;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            resize: vertical;
            transition: border-color 0.3s;
            background: #f8f9fa;
        }

        .import-input-group textarea:focus {
            outline: none;
            border-color: #3498db;
            background: white;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .modal-footer {
            background: #f8f9fa;
            padding: 20px 25px;
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            border-top: 1px solid #e9ecef;
        }

        .modal-btn-primary {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9em;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .modal-btn-primary:hover {
            background: #2980b9;
            transform: translateY(-1px);
        }

        .modal-btn-secondary {
            background: #95a5a6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9em;
            transition: all 0.3s;
        }

        .modal-btn-secondary:hover {
            background: #7f8c8d;
            transform: translateY(-1px);
        }

        /* Mobile Responsive Design */
        @media (max-width: 800px) {
            .container {
                padding: 10px;
            }
            
            .header {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .header-nav {
                flex-direction: column;
                gap: 10px;
            }
            
            .top-controls {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .control-box {
                text-align: center;
                min-height: auto;
                padding: 15px;
            }
            
            .import-export-group {
                text-align: left;
            }

            /* Modal mobile styles */
            .modal-content {
                width: 95%;
                margin: 10px;
            }

            .modal-header {
                padding: 15px 20px;
            }

            .modal-header h3 {
                font-size: 1.1em;
            }

            .modal-body {
                padding: 20px;
            }

            .modal-footer {
                padding: 15px 20px;
                flex-direction: column;
            }

            .modal-btn-primary,
            .modal-btn-secondary {
                width: 100%;
                justify-content: center;
            }
            
            .view-print-row {
                flex-direction: column;
                gap: 10px;
            }
            

            

            
            .main-layout {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .input-row {
                grid-template-columns: 1fr;
                gap: 10px;
                text-align: left;
            }
            
            .input-row select,
            .input-row input[type="text"] {
                width: 100%;
            }
            
            .checkbox-group {
                justify-content: center;
            }
            
            .remove-btn {
                align-self: center;
                margin-top: 10px;
            }
        }

        /* Print Header Styles (hidden on screen) */
        .print-header {
            display: none;
        }

        .preview-title {
            display: block;
        }

        /* Print Styles */
        @media print {
            @page {
                margin: 1cm; /* Reduced margins for more content space */
                size: A4;
            }

            body {
                background: white;
                color: black;
                font-size: 12pt;
                line-height: 1.2;
            }

            .header, .top-controls, .form-section {
                display: none !important;
            }

            .main-layout {
                grid-template-columns: 1fr;
                gap: 0;
                margin: 0;
            }

            .preview-section {
                background: white;
                box-shadow: none;
                border: none;
                padding: 0;
                margin: 0;
            }

            /* Hide screen preview title, show print header */
            .preview-title {
                display: none !important;
            }

            .print-header {
                display: block !important;
                text-align: center;
                margin-bottom: 30px;
                padding-bottom: 20px;
                border-bottom: 2px solid #2c3e50;
            }

            .print-title {
                color: #2c3e50;
                font-size: 24pt;
                font-weight: 700;
                margin: 0 0 10px 0;
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            }

            .print-date {
                color: #666;
                font-size: 11pt;
                margin: 0;
                font-style: italic;
            }

            /* Content styling for print */
            .category-section {
                margin-bottom: 15px;
                page-break-inside: avoid;
            }

            .category-section h3 {
                color: #2c3e50 !important;
                font-size: 14pt;
                font-weight: 600;
                margin-bottom: 8px;
                padding-bottom: 3px;
                border-bottom: 1px solid #ddd;
            }

            .entry {
                border: 1px solid #ddd !important;
                background: white !important;
                margin-bottom: 10px;
                padding: 10px;
                border-radius: 5px;
                page-break-inside: avoid;
            }

            .entry-title {
                color: #2c3e50 !important;
                font-size: 12pt;
                font-weight: 600;
                margin-bottom: 8px;
            }

            .entry-value {
                font-size: 11pt;
                line-height: 1.5;
            }

            /* Enhanced color coding for print */
            .password-table {
                display: table !important;
                width: 100% !important;
                border-collapse: separate !important;
                border-spacing: 2px !important;
                page-break-inside: avoid !important;
                margin: 15px 0 !important;
            }
            .password-table tr {
                display: table-row !important;
            }
            .char-cell { 
                display: table-cell !important;
                font-size: 14pt !important;
                padding: 10px 6px !important;
                min-width: 30px !important;
                text-align: center !important;
                vertical-align: middle !important;
                border: 1px solid #333 !important;
            }
            .char-number { 
                display: table-cell !important;
                font-size: 10pt !important;
                padding: 6px 4px !important;
                width: 30px !important;
                text-align: center !important;
                vertical-align: middle !important;
                border: 1px solid #666 !important;
                background: #f5f5f5 !important;
            }
            .char-cell.digit { 
                color: #0066cc !important; 
                background: #f0f8ff !important;
                border-color: #0066cc !important;
            }
            .char-cell.lower { 
                color: #000000 !important; 
                background: #f8f8f8 !important;
                border-color: #666 !important;
            }
            .char-cell.upper { 
                color: #006600 !important; 
                background: #f0fff0 !important;
                border-color: #006600 !important;
            }
            .char-cell.special { 
                color: #cc0000 !important; 
                background: #fff0f0 !important;
                border-color: #cc0000 !important;
            }

            .row-spacer {
                height: 5px !important;
            }

            .sequence-box {
                border: 2px solid #2c3e50 !important;
                background: white !important;
                margin: 2px;
                padding: 8px 12px;
                font-size: 12pt;
            }

            /* QR Code styling for print */
            .qr-code {
                margin: 15px 0;
                text-align: center;
                page-break-inside: avoid;
            }

            .qr-code canvas {
                border: 1px solid #ddd;
            }

            /* Export QR Code Container */
            #exportQrCodeContainer {
                display: block !important;
                margin-top: 30px;
                padding: 20px;
                border: 2px solid #2c3e50;
                border-radius: 10px;
                text-align: center;
                page-break-before: always;
            }

            #exportQrCodeContainer h3 {
                color: #2c3e50 !important;
                font-size: 14pt;
                margin-bottom: 10px;
            }

            #exportQrCodeContainer p {
                color: #666 !important;
                font-size: 10pt;
                margin-bottom: 15px;
            }

            /* Encrypted text styling */
            .encrypted {
                color: #e74c3c !important;
                background: #fff5f5 !important;
                border: 1px solid #e74c3c !important;
                padding: 5px 8px;
                border-radius: 3px;
                font-family: 'Courier New', monospace;
                font-size: 10pt;
                word-break: break-all;
            }

            .lock-icon {
                color: #e74c3c !important;
                margin-left: 5px;
            }
        }

        /* Responsive */
        @media (max-width: 1400px) {
            .main-layout {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .top-controls {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .input-row {
                grid-template-columns: 1fr;
                gap: 10px;
            }

            .input-row > * {
                width: 100%;
            }

            .header-nav {
                flex-direction: column;
                align-items: center;
            }

            .toggle-group {
                justify-content: center;
            }

            /* Mobile responsive fixes for password tables */
            .password-table {
                font-size: 0.8em;
                max-width: 100%;
                display: table;
                width: 100%;
            }

            .password-table tr {
                display: table-row;
            }

            .char-cell, .char-number {
                min-width: 30px;
                padding: 8px 4px;
                font-size: 0.9em;
            }

            /* Preview section mobile improvements */
            .preview-section {
                padding: 15px;
                margin: 10px 0;
            }

            .preview-section h2 {
                font-size: 1.3em;
            }

            #output {
                padding: 15px;
                font-size: 0.9em;
                overflow-x: auto;
            }

            /* Print customization mobile layout */
            .print-settings-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .print-customization-fieldset {
                padding: 15px;
                margin: 15px 0;
            }

            /* QR code mobile sizing */
            #qrcode canvas {
                max-width: 200px;
                height: auto;
            }
        }

        /* Footer Styles */
        .page-footer {
            background-color: white;
            border-top: 1px solid #ddd;
            padding: 40px 0 20px 0;
            margin-top: 60px;
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .footer-disclaimer {
            background-color: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 25px;
            margin-bottom: 30px;
        }

        .footer-disclaimer h4 {
            color: #3498db;
            font-size: 1.1rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .footer-disclaimer p {
            color: #666;
            font-size: 0.95rem;
            line-height: 1.6;
            margin: 0;
        }

        .footer-links {
            text-align: center;
            margin-bottom: 20px;
        }

        .footer-links a {
            color: #3498db;
            font-weight: 600;
            text-decoration: none;
        }

        .footer-links a:hover {
            text-decoration: underline;
        }

        .footer-separator {
            margin: 0 15px;
            color: #666;
        }

        .footer-copyright {
            text-align: center;
            padding-top: 20px;
            border-top: 1px solid #eaeaea;
        }

        .footer-copyright p {
            color: #666;
            font-size: 0.9rem;
            margin: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="page-header">
            <h1>Create Your Plan</h1>
            <p class="subtitle">Add all the information your loved ones might need. Everything is processed locally in your browser and is never sent to a server.</p>
            <nav class="main-nav">
                <a href="index.html" class="btn btn-secondary">Back to Home</a>
            </nav>
        </header>

        <main>
            <!-- Form Section -->
            <section class="form-section">
                <fieldset class="encryption-fieldset">
                    <legend>Optional: Add Encryption</legend>
                    <input type="password" id="masterKey" placeholder="Enter a strong Master Key here..." style="width: 100%; padding: 10px; font-size: 1rem; border-radius: 5px; border: 1px solid #ddd;">
                    <p class="disclaimer">
                        <strong>Important:</strong> If you set a Master Key, you MUST remember it. It cannot be recovered. 
                        This key will be used to encrypt any items you mark as "Encrypt".
                    </p>
                </fieldset>
                
                <!-- Print Customization Section -->
                <fieldset class="print-customization-fieldset">
                    <legend>Print Customization</legend>
                    <div class="print-settings-grid">
                        <div class="setting-group">
                            <label for="fontFamily">Font Family:</label>
                            <select id="fontFamily" onchange="updatePrintPreview()">
                                <option value="'Segoe UI', Tahoma, Geneva, Verdana, sans-serif">Segoe UI (Default)</option>
                                <option value="Arial, sans-serif">Arial</option>
                                <option value="'Times New Roman', serif">Times New Roman</option>
                                <option value="'Courier New', monospace">Courier New</option>
                                <option value="Georgia, serif">Georgia</option>
                            </select>
                        </div>
                        <div class="setting-group">
                            <label for="fontSize">Font Size:</label>
                            <select id="fontSize" onchange="updatePrintPreview()">
                                <option value="12pt">Small (12pt)</option>
                                <option value="14pt" selected>Medium (14pt)</option>
                                <option value="16pt">Large (16pt)</option>
                                <option value="18pt">Extra Large (18pt)</option>
                            </select>
                        </div>
                        <div class="setting-group">
                            <label for="colorMode">Print Mode:</label>
                            <div class="toggle-group">
                                <span class="toggle-label">B&W</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="colorMode" onchange="updatePrintPreview()" checked>
                                    <span class="slider"></span>
                                </label>
                                <span class="toggle-label">Color</span>
                            </div>
                        </div>
                    </div>
                </fieldset>

                <div class="form-controls">
                    <div class="action-buttons">
                        <button onclick="showImportModal()" class="btn btn-secondary">Import Data</button>
                        <button onclick="printDocument()" class="btn btn-primary">Print Document</button>
                    </div>
                </div>

                <div id="input-container" style="margin-top: 20px;">
                    <!-- Dynamic inputs will be added here -->
                </div>
                <br>
                <button onclick="addRow()" class="btn btn-primary">Add Information Row</button>
            </section>

            <!-- Preview Section -->
            <section class="preview-section">
                <h2>Live Preview</h2>
                <p>This is how your final document will look. You can print this page directly. Your data is updated live as you type.</p>
                <div id="output" style="margin-top: 20px; border: 1px solid #eee; padding: 20px; background: #fff; border-radius: 8px;"></div>
                <h3 style="margin-top: 30px;">Export & Import Data</h3>
                <p>The QR code below contains all your data. You can scan it with a standard QR app to copy the text, or use our Decrypt tool to import and decrypt it later.</p>
                <div id="qrcode" style="display: flex; justify-content: center; padding: 20px; background: white; margin-top: 15px;"></div>
            </section>
        </main>
    </div>

    <!-- Import Modal -->
    <div id="importModal" class="modal-overlay">
        <div class="modal-content">
            <button class="modal-close-btn" onclick="hideImportModal()">&times;</button>
            <h2>Import Data</h2>
            <p>Paste your backed-up data string below. If the data is encrypted, make sure you have entered the Master Key on the main page first.</p>
            <textarea id="importDataText" placeholder="Paste your data string here..."></textarea>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="hideImportModal()">Cancel</button>
                <button class="btn btn-primary" onclick="importDataFromModal()">Import</button>
            </div>
        </div>
    </div>

    <footer class="page-footer">
        <div class="footer-content">
            <div class="footer-disclaimer">
                <h4>On Shared Responsibility</h4>
                <p>MyLastKey is designed to be secure, and no data ever leaves your browser. However, the ultimate security of your data also depends on your own device. Ensure you use an updated browser and be cautious of browser plugins that could monitor your activity.</p>
            </div>
            <div class="footer-links">
                <a href="security.html">Security & Privacy Details</a>
                <span class="footer-separator">|</span>
                <a href="https://github.com/rasmusnielsen-eu/MyLastKey" target="_blank">View Source Code</a>
            </div>
            <div class="footer-copyright">
                <p>&copy; 2025 Rasmus Nielsen | <a href="https://rasmusnielsen.eu" target="_blank">rasmusnielsen.eu</a> | All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        let rowCounter = 0;
        const qrcode = new QRCode(document.getElementById("qrcode"), {
            width: 256,
            height: 256,
            correctLevel: QRCode.CorrectLevel.H
        });

        function addRow(type = 'user-pass', label = '', value = '', isEncrypted = false, isQR = false) {
            rowCounter++;
            const container = document.getElementById('input-container');
            const div = document.createElement('div');
            div.className = 'input-row';
            div.id = `row-${rowCounter}`;
            div.innerHTML = `
                <select onchange="processInputs()">
                    <option value="user-pass" ${type === 'user-pass' ? 'selected' : ''}>User/Password</option>
                    <option value="pin" ${type === 'pin' ? 'selected' : ''}>PIN Code</option>
                    <option value="text" ${type === 'text' ? 'selected' : ''}>Note/Text</option>
                </select>
                <input type="text" placeholder="Label/Title" value="${label}">
                <input type="text" placeholder="Value" value="${value}">
                <div class="checkbox-group">
                    <input type="checkbox" id="encrypt-check-${rowCounter}" ${isEncrypted ? 'checked' : ''}> <label for="encrypt-check-${rowCounter}">Encrypt</label>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="qr-check-${rowCounter}" ${isQR ? 'checked' : ''}> <label for="qr-check-${rowCounter}">QR Code</label>
                </div>
                <button class="remove-btn" onclick="removeRow(${rowCounter})">×</button>
            `;
            container.appendChild(div);
            updateEventListeners();
        }
        
        function removeRow(id) {
            document.getElementById(`row-${id}`).remove();
            processInputs();
        }

        function updateEventListeners() {
            const inputs = document.querySelectorAll('#input-container input, #input-container select, #masterKey');
            inputs.forEach(input => {
                input.removeEventListener('input', processInputs); // Prevent duplicates
                input.removeEventListener('change', processInputs);
                input.addEventListener('input', processInputs);
                input.addEventListener('change', processInputs);
            });
        }
        
        function sanitizeQRInput(str) {
            if (str.startsWith("data:")) return str;
            return str.replace(/<|>/g, "");
        }

        function encryptText(text, masterKey) {
            if (!masterKey) return text;
            try {
                const salt = CryptoJS.lib.WordArray.random(128 / 8);
                const iv = CryptoJS.lib.WordArray.random(128 / 8);
                const key = CryptoJS.PBKDF2(masterKey, salt, { keySize: 256 / 32, iterations: 250000, hasher: CryptoJS.algo.SHA256 });
                const encrypted = CryptoJS.AES.encrypt(text, key, { iv: iv });
                return `${salt.toString()}:${iv.toString()}:${encrypted.toString()}`;
            } catch (e) { return "Encryption Error!"; }
        }

        function decryptText(encryptedStr, masterKey) {
            if (!masterKey) throw new Error("A Master Key is required for decryption.");
            const parts = encryptedStr.split(':');
            if (parts.length !== 3) throw new Error("Invalid encrypted format.");
            const salt = CryptoJS.enc.Hex.parse(parts[0]);
            const iv = CryptoJS.enc.Hex.parse(parts[1]);
            const encrypted = parts[2];
            const key = CryptoJS.PBKDF2(masterKey, salt, { keySize: 256 / 32, iterations: 250000, hasher: CryptoJS.algo.SHA256 });
            const decrypted = CryptoJS.AES.decrypt(encrypted, key, { iv: iv });
            return decrypted.toString(CryptoJS.enc.Utf8);
        }

        function formatEnhanced(value) {
            const maxCharsPerRow = 18; // Maximum characters per row for better readability
            let table = '<table class="password-table">';
            
            console.log('formatEnhanced called with:', value, 'length:', value.length);
            
            // Split password into chunks of maxCharsPerRow
            for (let rowStart = 0; rowStart < value.length; rowStart += maxCharsPerRow) {
                const rowChars = value.slice(rowStart, rowStart + maxCharsPerRow);
                
                console.log(`Row ${Math.floor(rowStart/maxCharsPerRow) + 1}: start=${rowStart}, chars="${rowChars}", length=${rowChars.length}`);
                
                // Character row
                table += '<tr>';
                for (let char of rowChars) {
                    let className = 'char-cell ';
                    if (/\d/.test(char)) className += 'digit';
                    else if (/[a-z]/.test(char)) className += 'lower';
                    else if (/[A-Z]/.test(char)) className += 'upper';
                    else className += 'special';
                    table += `<td class="${className}">${char}</td>`;
                }
                table += '</tr>';
                
                // Number row
                table += '<tr>';
                for (let i = 0; i < rowChars.length; i++) {
                    const position = rowStart + i + 1;
                    table += `<td class="char-number">${position}</td>`;
                }
                table += '</tr>';
                
                // Add spacing between rows if there are more rows
                if (rowStart + maxCharsPerRow < value.length) {
                    table += '<tr><td colspan="' + rowChars.length + '" class="row-spacer"></td></tr>';
                }
            }
            
            table += '</table>';
            console.log('Generated table HTML length:', table.length);
            return table;
        }

        function getPrintHeader() {
            const now = new Date();
            const options = { year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit' };
            const dateTime = now.toLocaleDateString('en-US', options);
            return `<h1>My Last Key</h1><p>Printed on: ${dateTime}</p><hr>`;
        }

        function updatePrintPreview() {
            const fontFamily = document.getElementById('fontFamily').value;
            const fontSize = document.getElementById('fontSize').value;
            const colorMode = document.getElementById('colorMode').checked;
            
            // Apply styles to preview
            const output = document.getElementById('output');
            output.style.fontFamily = fontFamily;
            output.style.fontSize = fontSize;
            
            // Update print styles dynamically
            updatePrintStyles(fontFamily, fontSize, colorMode);
            
            // Refresh the preview content
            processInputs();
        }

        function updatePrintStyles(fontFamily, fontSize, colorMode) {
            // Remove existing dynamic print styles
            const existingStyle = document.getElementById('dynamic-print-styles');
            if (existingStyle) {
                existingStyle.remove();
            }
            
            // Create new dynamic print styles
            const style = document.createElement('style');
            style.id = 'dynamic-print-styles';
            
            let printCSS = `
                @media print {
                    body {
                        font-family: ${fontFamily} !important;
                        font-size: ${fontSize} !important;
                    }
                    
                    .print-title {
                        font-family: ${fontFamily} !important;
                    }
                    
                    .category-section h3 {
                        font-family: ${fontFamily} !important;
                    }
                    
                    .entry-title {
                        font-family: ${fontFamily} !important;
                    }
                    
                    .entry-value {
                        font-family: ${fontFamily} !important;
                    }
            `;
            
            if (!colorMode) {
                // Black and white mode
                printCSS += `
                    .char-cell.digit { 
                        color: #000000 !important; 
                        background: #ffffff !important;
                        border-color: #000000 !important;
                    }
                    .char-cell.lower { 
                        color: #000000 !important; 
                        background: #ffffff !important;
                        border-color: #000000 !important;
                    }
                    .char-cell.upper { 
                        color: #000000 !important; 
                        background: #ffffff !important;
                        border-color: #000000 !important;
                    }
                    .char-cell.special { 
                        color: #000000 !important; 
                        background: #ffffff !important;
                        border-color: #000000 !important;
                    }
                `;
            }
            
            printCSS += `}`;
            style.textContent = printCSS;
            document.head.appendChild(style);
        }
        
        function processInputs() {
            const rows = document.querySelectorAll('.input-row');
            const masterKey = document.getElementById('masterKey').value;
            let outputHTML = getPrintHeader();
            let combinedQRData = [];

            rows.forEach(row => {
                const select = row.querySelector('select');
                const inputs = row.querySelectorAll('input[type="text"]');
                const label = inputs[0].value;
                let value = inputs[1].value;
                const isEncrypted = row.querySelector('input[type="checkbox"][id^="encrypt-check"]').checked;
                const isQR = row.querySelector('input[type="checkbox"][id^="qr-check"]').checked;

                if (label || value) {
                    const displayValue = isEncrypted ? encryptText(value, masterKey) : value;
                    outputHTML += `<h3>${label}</h3>`;
                    
                    if (select.value === 'user-pass' && !isEncrypted) {
                         outputHTML += formatEnhanced(value);
                    } else {
                        outputHTML += `<p style="word-break: break-all;">${displayValue}</p>`;
                    }

                    if (isQR) {
                        const qrContainerId = `qr-output-${row.id}`;
                        outputHTML += `<div id="${qrContainerId}" class="qr-code-container" style="padding-top: 10px;"></div>`;
                        setTimeout(() => {
                            const qrEl = document.getElementById(qrContainerId);
                            if(qrEl) {
                                qrEl.innerHTML = "";
                                new QRCode(qrEl, { text: displayValue, width: 128, height: 128 });
                            }
                        }, 0);
                    }
                    outputHTML += '<hr>';
                    combinedQRData.push({l: label, v: value, e: isEncrypted, t: select.value, q: isQR});
                }
            });

            document.getElementById('output').innerHTML = outputHTML;
            
            const sanitizedData = sanitizeQRInput(JSON.stringify(combinedQRData));
            if (combinedQRData.length > 0) {
                 const fullEncryptedString = encryptText(sanitizedData, masterKey);
                 qrcode.clear();
                 qrcode.makeCode(fullEncryptedString);
            } else {
                 qrcode.clear();
            }
        }
        
        function printDocument() {
            window.print();
        }

        function showImportModal() {
            document.getElementById('importModal').classList.add('visible');
        }

        function hideImportModal() {
            document.getElementById('importModal').classList.remove('visible');
        }

        function importDataFromModal() {
            const data = document.getElementById('importDataText').value;
            if (data) {
                importData(data);
            }
            hideImportModal();
        }
        
        function importData(data) {
            try {
                let decryptedData = data;
                const masterKey = document.getElementById('masterKey').value;
                
                if (data.includes(':') && data.split(':').length === 3) {
                     if (!masterKey) {
                        alert("This data seems to be encrypted. Please enter the Master Key before importing.");
                        return;
                    }
                    decryptedData = decryptText(data, masterKey);
                }

                const jsonData = JSON.parse(decryptedData);
                
                // Clear existing rows
                const container = document.getElementById('input-container');
                container.innerHTML = '';
                rowCounter = 0;
                
                // Add new rows from data
                jsonData.forEach(item => {
                    addRow(item.t, item.l, item.v, item.e, item.q);
                });
                
                processInputs(); // Refresh the preview
            } catch (e) {
                alert("Import failed. The data may be corrupted or the Master Key is incorrect. Error: " + e.message);
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            addRow(); // Start with one row
            updateEventListeners();
            updatePrintPreview(); // Initialize print preview with default settings
            processInputs(); // Initial render of the print header
        });
    </script>
</body>
</html> 